---
title: Android内存优化 -- DiskLruCache
date: 2019-10-23 21:03:14
tags: [Android优化]
categories: android

---

Android 崩溃分为: Java 崩溃, Native 崩溃, ANR

>崩溃率只是一个数字，我们的出发点应该是让用户有更好的体验

# 如何衡量崩溃

```
UV 崩溃率 = 发生崩溃的 UV / 登录的 UV
UV 异常率 = 发生异常退出或崩溃的 UV / 登录 UV
```

其他指标:

1. PV 崩溃率
2. 启动崩溃率
3. 重复崩溃率

# 启动崩溃处理方案

**安全模式**

[安全模式：天猫App启动保护实践](https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&mid=2247488429&idx=1&sn=448b414a0424d06855359b3eb2ba8569&source=41#wechat_redirect)

出现启动崩溃的时候，无法通过热更新和app推送更新方式正常更新应用。

基本实现原理:

```
应用启动
标记数 + 1

----
安全模式逻辑：
判断标记数 > 2 -> 进入安全模式 -> 启动自修复(清理应用数据...) -> 检查热更新
----

正常启动
重置标记逻辑(标记数=0，清除标记时机: 正常启动10s, 用户正常退出, 用户主动从前台切换到后台)
```

1. 通过判断 标记数，实现判断 app 上次是否是异常退出
2. 安全模式分级: crash 2 次为一级安全模式，crash 3 次为二级安全模式

```
一级安全模式: 清空某个业务缓存数据
二级安全模式: 清空所有数据，老版本执行同步阻塞热修复功能
```

安全模式实现要考虑易用性。灰度机制(在用户没有 crash 情况下，强制进入安全模式)


# 崩溃日志应该包含哪些信息

1. 崩溃信息

进程名，线程名。前台进程还是后台进程，是否是 UI 线程

崩溃堆栈和类型。崩溃属于 Java 崩溃，还是 Native 崩溃，ANR.

2. 系统信息

机型，系统，厂商，CPU, ABI

设备状态: 是否 root, 是否是模拟器

3. 内存信息

OOM, ANR, 虚拟内存是否耗尽。

4. 资源信息

5. 应用信息

应用版本号

# 崩溃分析


1. 确定重点

确认严重程度

崩溃基本信息分析: Java 崩溃，Native 崩溃，ANR 

Logcat

各个资源情况

2. 查找共性

发生同类型崩溃的机型，系统版本

3. 尝试复现



