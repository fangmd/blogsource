---
title: 网络协议
date: 2016-05-15 12:18:12
tags: 网络协议
category: android

---

# 网络协议

## 概述

### 五层模型(七层，四层，按自己理解)

- 应用层 Application Layer
- 传输层 Transport Layer
- 网络层 Network Layer
- 链接层 Link Layer
- 实体层 Physical Layer

越下面的层级，越靠近硬件；

### 层与协议
互联网协议：Internet Protocol Suite

#### 实体层

物理链接电脑：光缆/电缆/无线电波

主要规定了网络的一些电气特性

作用:负责传送0和1的电信号。

#### 链接层

##### 定义
单纯的0和1没有任何意义，必须规定解读方式：多少个电信号算一组？每个信号位有何意义？

>这就是"链接层"的功能，它在"实体层"的上方，确定了0和1的分组方式。

##### 以太网协议
一组电信号构成一个数据包：叫做Frame帧

每一Frame：标头Head -- 数据Data

*标头：*包含数据包的一些说明项，比如发送者、接受者、数据类型等等；"数据"则是数据包的具体内容。"标头"的长度，固定为18字节。

*数据：*长度，最短为46字节，最长为1500字节。

如果数据很长，就必须分割成多个帧进行发送。

##### MAC地址
上面提到，以太网数据包的"标头"，包含了发送者和接受者的信息。那么，发送者和接受者是如何标识呢？

以太网规定，连入网络的所有设备，都必须具有"网卡"接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。

MAC地址：长度是48个二进制位，通常用12个十六进制数表示。

![http://image.beekka.com/blog/201205/bg2012052906.png](http://image.beekka.com/blog/201205/bg2012052906.png)

前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。

有了MAC地址，就可以定位网卡和数据包的路径了。

*MAC地址，定义地址*
##### 广播

1号计算机向2号计算机发送一个数据包，同一个子网络的3号、4号、5号计算机都会收到这个包。它们读取这个包的"标头"，找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式就叫做"广播"（broadcasting）。

>效率低，局限在发送者所在的子网络；所以有了网络层
#### 网络层
作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做"网络地址"，简称"网址"。

每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。

网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。

##### IP协议
规定网络地址的协议，叫做IP协议，IP地址；IPv4，IPv6

"子网掩码"，就是表示子网络特征的一个参数。它的网络部分全部为1，主机部分全部为0。

知道"子网掩码"，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。


IP协议作用：

1. 为每一台计算机分配IP地址
2. 确定哪些地址在同一个子网络。(配合子网掩码)

##### IP数据包
根据IP协议发送的数据，就叫做IP数据包。

IP数据包直接放进以太网数据包的"数据"部分

互联网分层结构的好处：上层的变动完全不涉及下层的结构。

IP数据包：

1. 标头Head：主要包括版本、长度、IP地址等信息
2. 数据Data：IP数据包的具体内容

##### ARP协议

因为IP数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址。通常情况下，对方的IP地址是已知的（后文会解释），但是我们不知道它的MAC地址。

所以，我们需要一种机制，能够从IP地址得到MAC地址。

这里又可以分成两种情况。

1. 如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的"网关"（gateway），让网关去处理。

2. 如果两台主机在同一个子网络，那么我们可以用ARP协议，得到对方的MAC地址。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个"广播"地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。

总之，有了ARP协议之后，我们就可以得到同一个子网络内的主机MAC地址，可以把数据包发送到任意一台主机之上了。

#### 传输层
有了MAC地址和IP地址，我们已经可以在互联网上任意两台主机上建立通信。

##### 端口
是0到65535之间的一个整数，0到1023的端口被系统占用，用户只能选用大于1023的端口。

一个应用程序一个端口

##### 作用
就是建立"端口到端口"的通信。相比之下，"网络层"的功能是建立"主机到主机"的通信。只要确定主机和端口，我们就能实现程序之间的交流。

Unix系统就把主机+端口，叫做"套接字"（socket）

有了它，就可以进行网络应用程序开发了。

##### UDP协议
>在数据包中加入端口信息，这就需要新的协议。

UDP数据包：它的格式几乎就是在数据前面，加上端口号。

1. 标头Head：定义了发出端口和接收端口
2. 数据Data：具体的内容

把整个UDP数据包放入IP数据包的"数据"部分，

UDP数据包非常简单，"标头"部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。

##### TCP协议
UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。

>有确认机制的UDP协议

TCP协议能够确保数据不会遗失。它的缺点是过程复杂、实现困难、消耗较多的资源。


#### 应用层
应用程序收到"传输层"的数据，接下来就要进行解读。

TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等

以太网的数据包结构：

![http://image.beekka.com/blog/201205/bg2012052913.png](http://image.beekka.com/blog/201205/bg2012052913.png)











参考：[http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html](http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)
